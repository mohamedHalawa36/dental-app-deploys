var P=r=>{throw TypeError(r)};var g=(r,t,e)=>t.has(r)||P("Cannot "+e);var i=(r,t,e)=>(g(r,t,"read from private field"),e?e.call(r):t.get(r)),c=(r,t,e)=>t.has(r)?P("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),h=(r,t,e,s)=>(g(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e),d=(r,t,e)=>(g(r,t,"access private method"),e);import{G as B,R as W,E as $,c as T,x as z,s as J,r as L,C as N,H as V,I as k,n as X,e as Y}from"./QueryClientProvider-DuLNCRAu.js";var y,C,o,v,n,S,m,u,l,j,st=(j=class extends W{constructor(t){super();c(this,u);c(this,y);c(this,C);c(this,o);c(this,v);c(this,n);c(this,S);c(this,m);h(this,m,!1),h(this,S,t.defaultOptions),this.setOptions(t.options),this.observers=[],h(this,v,t.client),h(this,o,i(this,v).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,h(this,y,H(this.options)),this.state=t.state??i(this,y),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=i(this,n))==null?void 0:t.promise}setOptions(t){if(this.options={...i(this,S),...t},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=H(this.options);e.data!==void 0&&(this.setData(e.data,{updatedAt:e.dataUpdatedAt,manual:!0}),h(this,y,e))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&i(this,o).remove(this)}setData(t,e){const s=$(this.state.data,t,this.options);return d(this,u,l).call(this,{data:s,type:"success",dataUpdatedAt:e==null?void 0:e.updatedAt,manual:e==null?void 0:e.manual}),s}setState(t,e){d(this,u,l).call(this,{type:"setState",state:t,setStateOptions:e})}cancel(t){var s,f;const e=(s=i(this,n))==null?void 0:s.promise;return(f=i(this,n))==null||f.cancel(t),e?e.then(T).catch(T):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(i(this,y))}isActive(){return this.observers.some(t=>z(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===J||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>L(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!N(this.state.dataUpdatedAt,t)}onFocus(){var e;const t=this.observers.find(s=>s.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(e=i(this,n))==null||e.continue()}onOnline(){var e;const t=this.observers.find(s=>s.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(e=i(this,n))==null||e.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),i(this,o).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(i(this,n)&&(i(this,m)?i(this,n).cancel({revert:!0}):i(this,n).cancelRetry()),this.scheduleGc()),i(this,o).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||d(this,u,l).call(this,{type:"invalidate"})}async fetch(t,e){var U,D,q,A,R,w,x,I,M,O,Q,E;if(this.state.fetchStatus!=="idle"&&((U=i(this,n))==null?void 0:U.status())!=="rejected"){if(this.state.data!==void 0&&(e!=null&&e.cancelRefetch))this.cancel({silent:!0});else if(i(this,n))return i(this,n).continueRetry(),i(this,n).promise}if(t&&this.setOptions(t),!this.options.queryFn){const a=this.observers.find(F=>F.options.queryFn);a&&this.setOptions(a.options)}const s=new AbortController,f=a=>{Object.defineProperty(a,"signal",{enumerable:!0,get:()=>(h(this,m,!0),s.signal)})},b=()=>{const a=Y(this.options,e),G=(()=>{const K={client:i(this,v),queryKey:this.queryKey,meta:this.meta};return f(K),K})();return h(this,m,!1),this.options.persister?this.options.persister(a,G,this):a(G)},p=(()=>{const a={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:i(this,v),state:this.state,fetchFn:b};return f(a),a})();(D=this.options.behavior)==null||D.onFetch(p,this),h(this,C,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((q=p.fetchOptions)==null?void 0:q.meta))&&d(this,u,l).call(this,{type:"fetch",meta:(A=p.fetchOptions)==null?void 0:A.meta}),h(this,n,V({initialPromise:e==null?void 0:e.initialPromise,fn:p.fetchFn,onCancel:a=>{a instanceof k&&a.revert&&this.setState({...i(this,C),fetchStatus:"idle"}),s.abort()},onFail:(a,F)=>{d(this,u,l).call(this,{type:"failed",failureCount:a,error:F})},onPause:()=>{d(this,u,l).call(this,{type:"pause"})},onContinue:()=>{d(this,u,l).call(this,{type:"continue"})},retry:p.options.retry,retryDelay:p.options.retryDelay,networkMode:p.options.networkMode,canRun:()=>!0}));try{const a=await i(this,n).start();if(a===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(a),(w=(R=i(this,o).config).onSuccess)==null||w.call(R,a,this),(I=(x=i(this,o).config).onSettled)==null||I.call(x,a,this.state.error,this),a}catch(a){if(a instanceof k){if(a.silent)return i(this,n).promise;if(a.revert){if(this.state.data===void 0)throw a;return this.state.data}}throw d(this,u,l).call(this,{type:"error",error:a}),(O=(M=i(this,o).config).onError)==null||O.call(M,a,this),(E=(Q=i(this,o).config).onSettled)==null||E.call(Q,this.state.data,a,this),a}finally{this.scheduleGc()}}},y=new WeakMap,C=new WeakMap,o=new WeakMap,v=new WeakMap,n=new WeakMap,S=new WeakMap,m=new WeakMap,u=new WeakSet,l=function(t){const e=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...Z(s.data,this.options),fetchMeta:t.meta??null};case"success":const f={...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return h(this,C,t.manual?f:void 0),f;case"error":const b=t.error;return{...s,error:b,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:b,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=e(this.state),X.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),i(this,o).notify({query:this,type:"updated",action:t})})},j);function Z(r,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:B(t.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function H(r){const t=typeof r.initialData=="function"?r.initialData():r.initialData,e=t!==void 0,s=e?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:e?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:e?"success":"pending",fetchStatus:"idle"}}export{st as Q,Z as f};
