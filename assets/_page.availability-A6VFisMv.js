import{r as f,p as e,w as D}from"./chunk-PVWAREVJ-DbUQBqSc.js";import{C as S,u as g,L as O,R as C}from"./RenderData-B43l8-Xj.js";import{d as P,u as M,a as K,g as L,P as E,b as N}from"./Pencil-B49a0cmu.js";import{D as k,M as V,S as w,F as x}from"./Delete-B2qUI6Xb.js";import{x as j,k as d,u as h,W as I,X as b}from"./QueryClientProvider-B0e4pmks.js";import{u as _}from"./input-D3y1GKQf.js";import{c as q,a as u,F as Q}from"./index.esm-C0DY_CMF.js";import{P as B}from"./PageLoader-C78sVI-V.js";import{I as v}from"./InputField-Bsv0isQJ.js";import{T}from"./Table-Dpv5xUBt.js";import{u as R}from"./usePageContext-BKn3lOPF.js";import"./query-6el0zP7v.js";import"./Input-D675VA38.js";import"./ChevronLeft-DQqe5Vbc.js";import"./button-BX8rGgMC.js";import"./PageContext-CweN0xE8.js";function $({availabilityId:t}){const r=j(),[a,i]=f.useState(!1),{mutate:n,isPending:s}=_({mutationFn:P,onSuccess:()=>{r.invalidateQueries({queryKey:["doctor_availability"]})}});return e.jsx(S,{toggle:()=>i(m=>!m),isOpen:a,isActionsDisabled:s,title:"حذف موعد",trigger:e.jsx(k,{className:"size-6 fill-red-600"}),confirmCallBack:()=>n(t),cancelCallBack:()=>i(!1),children:e.jsx("p",{children:"هل أنت متأكد من حذف هذا الموعد"})})}const z=t=>q({day:u().required(d).test({test:r=>!t.some(a=>a.day===r),message:"يوجد موعد في هذا اليوم بالفعل"}),start_time:u().required(d),end_time:u().required(d),doctor_id:u().required(d)}),U=(t,r)=>q({day:u().test({test:a=>{const i=t.find(s=>s.id===r),n=i==null?void 0:i.day;return!t.filter(s=>s.day!==n).some(s=>s.day===a)},message:"يوجد موعد في هذا اليوم بالفعل"}).required(d),start_time:u().required(d),end_time:u().required(d),doctor_id:u().required(d)}),W={doctor_id:"",start_time:"",end_time:"",day:""},X=[{value:"6",label:"السبت"},{value:"0",label:"الأحد"},{value:"1",label:"الإثنين"},{value:"2",label:"الثلاثاء"},{value:"3",label:"الأربعاء"},{value:"4",label:"الخميس"},{value:"5",label:"الجمعة"}];function A({recordId:t,currAvailabilities:r,setIsOpen:a}){var l;const i=j(),{userId:n}=h(),{data:s,isLoading:m,isError:c}=g({enabled:!!t,queryKey:["availability",t],queryFn:()=>L(n,t)}),y=(l=s==null?void 0:s.data)==null?void 0:l[0],{mutate:p,isPending:o}=_({mutationFn:t?M:K,onSuccess:()=>{i.invalidateQueries({queryKey:["doctor_availability"]})},onSettled:()=>a(!1)});return m?e.jsx(B,{}):c?e.jsx(O,{}):e.jsx(Q,{initialValues:{...t?y:W,doctor_id:n},validationSchema:t?U(r,t):z(r),onSubmit:F=>p(F),children:()=>e.jsxs(V,{isSubmitting:o,submitBtnLabel:t?"تعديل":"إضافة",children:[e.jsx(w,{options:X,name:"day",label:"اليوم",placeholder:"اختر اليوم"}),e.jsx("div",{}),e.jsx(v,{label:"من",name:"start_time",type:"time"}),e.jsx(v,{label:"إلى",name:"end_time",type:"time"})]})})}function G({currAvailabilities:t,recordId:r}){const[a,i]=f.useState(!1);return e.jsx(x,{title:"تعديل موعد",isOpen:a,setIsOpen:i,trigger:e.jsx(E,{className:"stroke-primary"}),children:e.jsx(A,{currAvailabilities:t,recordId:r,isOpen:a,setIsOpen:i})})}const me=D(function(){const{addNewOpen:r,setAddNewOpen:a}=R(),{userId:i}=h(),{data:n,isFetching:s,isError:m}=g({queryKey:["doctor_availability","5a6cc0f9-cd61-4929-811f-0364fc66074c"],queryFn:()=>N(i)}),c=(n==null?void 0:n.data)??[],y=(c==null?void 0:c.length)===0,p=[{accessorKey:"day",header:"اليوم",cell:({row:o})=>{const l=o.getValue("day");return I(l)}},{accessorKey:"start_time",header:"من",cell:({row:o})=>{const l=o.getValue("start_time");return b(l)}},{accessorKey:"end_time",header:"إلى",cell:({row:o})=>{const l=o.getValue("end_time");return b(l)}},{header:"تعديل",cell:({row:o})=>{const l=o.original.id;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{recordId:l,currAvailabilities:c}),e.jsx($,{availabilityId:l})]})}}];return e.jsxs(e.Fragment,{children:[e.jsx(C,{isEmpty:y,isFetching:s,isError:m,children:e.jsx(T,{data:c??[],columns:p})}),e.jsx(x,{title:"إضافة موعد",isOpen:r,setIsOpen:a,children:e.jsx(A,{setIsOpen:a,currAvailabilities:c})})]})});export{me as default};
