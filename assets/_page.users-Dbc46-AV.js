import{r as p,p as e,w as f}from"./chunk-PVWAREVJ-chYXeG9N.js";import{C as h,D as x,u as y,R as j,a as C}from"./Delete-BQo3T8aW.js";import{t as m,v as A,q as b,l as k,j as w,u as g}from"./QueryClientProvider-DuLNCRAu.js";import{T as N}from"./Table-B4PqmJEJ.js";import{X as _}from"./X-Bv4KSavp.js";import{u as q}from"./utils-BfN3Mk9d.js";import{P as v}from"./PageContext-BJHu0vOw.js";import"./query-BmC5EiLz.js";import"./useAttachBackBtn-n1K_AgdM.js";import"./button-jEkwkEZj.js";import"./index-BU_VrOYq.js";const{success:{user:{delete:O}}}=b,P=async()=>await k.from("profiles").select("*"),F=async(o,i)=>{const n=await fetch("https://rhibyqyxpkcouaxhicgr.supabase.co/functions/v1/delete-auth-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({user_id:o})}),s=await n.json();if(!n.ok)throw m.error(A),new Error((s==null?void 0:s.error)||"Failed to delete user");return m.success(O),s};function K({userId:o}){var t;const i=w(),{authData:n}=g(),s=(t=n==null?void 0:n.session)==null?void 0:t.access_token,[c,r]=p.useState(!1),{mutate:l,isPending:u}=q({mutationFn:()=>F(o,s),onSuccess:()=>{i.invalidateQueries({queryKey:["users"]}),r(!1)}});return e.jsx(h,{toggle:()=>r(a=>!a),isOpen:c,isActionsDisabled:u,title:"حذف مستخدم",trigger:e.jsx(x,{className:"size-6 fill-red-600"}),confirmCallBack:()=>l(),cancelCallBack:()=>r(!1),children:e.jsx("p",{children:"هل أنت متأكد من حذف هذا المستخدم"})})}const V=f(function(){const{addNewOpen:i,setAddNewOpen:n}=p.useContext(v);g();const{data:s,isFetching:c}=y({queryKey:["users"],queryFn:P}),r=(s==null?void 0:s.data)??[],l=(r==null?void 0:r.length)===0,u=[{accessorKey:"name",header:"الاسم"},{accessorKey:"role",header:"الوظيفة",cell:({row:t})=>t.getValue("role")==="doctor"?"طبيب":"ممرض"},{accessorKey:"is_admin",header:"Admin",cell:({row:t})=>t.getValue("is_admin")?e.jsx(C,{className:"stroke-green-600"}):e.jsx(_,{className:"fill-red-600"})},{header:"تعديل",cell:({row:t})=>{const a=t.original.id,d=t.original.is_admin;return e.jsx("div",{className:"flex items-center gap-1",children:!d&&e.jsx(K,{userId:a})})}}];return e.jsx(e.Fragment,{children:e.jsx(j,{isEmpty:l,isFetching:c,children:e.jsx(N,{data:r??[],columns:u})})})});export{V as default};
