import{r as g,p as e,w as h}from"./chunk-PVWAREVJ-chYXeG9N.js";import{C as x,D as y,u as j,R as C,a as A}from"./Delete-BPxKI8CK.js";import{t as p,Y as b,m as k,V as w,O as N,u as f}from"./QueryClientProvider-BqgdReT-.js";import{T as O}from"./Table-BBBwjNa-.js";import{X as _}from"./X-CLvgzSVp.js";import{u as P}from"./useMutation-B3gH0LfH.js";import{P as q}from"./PageContext-BJHu0vOw.js";import"./query-DGTHriLT.js";import"./useAttachBackBtn-D6lZUQZl.js";import"./button-CQep-S3G.js";import"./index-BYUHeQo4.js";const{success:{user:{delete:v}}}=k,E=async()=>await w.from("profiles").select("*"),F=async(o,i)=>{const r=await fetch("https://rhibyqyxpkcouaxhicgr.supabase.co/functions/v1/delete-auth-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({user_id:o})}),s=await r.json();if(!r.ok)throw p.error(b),new Error((s==null?void 0:s.error)||"Failed to delete user");return p.success(v),s};function K({userId:o}){var c;const i=N(),{authData:r}=f(),s=(c=r==null?void 0:r.session)==null?void 0:c.access_token,[l,a]=g.useState(!1),{mutate:n,isPending:u}=P({mutationFn:()=>F(o,s),onSuccess:()=>{i.invalidateQueries({queryKey:["users"]}),a(!1)}});return e.jsx(x,{toggle:()=>a(t=>!t),isOpen:l,isActionsDisabled:u,title:"حذف مستخدم",trigger:e.jsx(y,{className:"size-6 fill-red-600"}),confirmCallBack:()=>n(),cancelCallBack:()=>a(!1),children:e.jsx("p",{children:"هل أنت متأكد من حذف هذا المستخدم"})})}const W=h(function(){const{addNewOpen:i,setAddNewOpen:r}=g.useContext(q);f();const{data:s,isFetching:l,isError:a}=j({queryKey:["users"],queryFn:E}),n=(s==null?void 0:s.data)??[],u=(n==null?void 0:n.length)===0,c=[{accessorKey:"name",header:"الاسم"},{accessorKey:"role",header:"الوظيفة",cell:({row:t})=>t.getValue("role")==="doctor"?"طبيب":"ممرض"},{accessorKey:"is_admin",header:"Admin",cell:({row:t})=>t.getValue("is_admin")?e.jsx(A,{className:"stroke-green-600"}):e.jsx(_,{className:"fill-red-600"})},{header:"تعديل",cell:({row:t})=>{const d=t.original.id,m=t.original.is_admin;return e.jsx("div",{className:"flex items-center gap-1",children:!m&&e.jsx(K,{userId:d})})}}];return e.jsx(e.Fragment,{children:e.jsx(C,{isEmpty:u,isFetching:l,isError:a,children:e.jsx(O,{data:n??[],columns:c})})})});export{W as default};
