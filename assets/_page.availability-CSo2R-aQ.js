import{r as b,p as e,w as F}from"./chunk-PVWAREVJ-chYXeG9N.js";import{C as D,D as O,u as f,M as S,e as C,F as x,R as P}from"./Delete-uu9hnkAx.js";import{d as M,u as K,a as N,g as k,P as L,b as V}from"./Pencil-BMMWCi5K.js";import{P as h,k as d,u as j,R as w,U as v}from"./QueryClientProvider-Xy3iKmL1.js";import{u as _}from"./Input-DuMdQrAz.js";import{c as q,a as u,F as E,I as g}from"./index.esm-CQa9_x3t.js";import{P as I}from"./useAttachBackBtn-D2A7XsYt.js";import{T as Q}from"./Table-BlVHF3N7.js";import{d as B}from"./X-COVWdvlK.js";import"./query-CXdU6cDq.js";import"./button-D8rxGqGp.js";function R({availabilityId:t}){const l=h(),[a,i]=b.useState(!1),{mutate:r,isPending:s}=_({mutationFn:M,onSuccess:()=>{l.invalidateQueries({queryKey:["doctor_availability"]})}});return e.jsx(D,{toggle:()=>i(m=>!m),isOpen:a,isActionsDisabled:s,title:"حذف موعد",trigger:e.jsx(O,{className:"size-6 fill-red-600"}),confirmCallBack:()=>r(t),cancelCallBack:()=>i(!1),children:e.jsx("p",{children:"هل أنت متأكد من حذف هذا الموعد"})})}const T=t=>q({day:u().required(d).test({test:l=>!t.some(a=>a.day===l),message:"يوجد موعد في هذا اليوم بالفعل"}),start_time:u().required(d),end_time:u().required(d),doctor_id:u().required(d)}),U=(t,l)=>q({day:u().test({test:a=>{const i=t.find(s=>s.id===l),r=i==null?void 0:i.day;return!t.filter(s=>s.day!==r).some(s=>s.day===a)},message:"يوجد موعد في هذا اليوم بالفعل"}).required(d),start_time:u().required(d),end_time:u().required(d),doctor_id:u().required(d)}),$={doctor_id:"",start_time:"",end_time:"",day:""},z=[{value:"6",label:"السبت"},{value:"0",label:"الأحد"},{value:"1",label:"الإثنين"},{value:"2",label:"الثلاثاء"},{value:"3",label:"الأربعاء"},{value:"4",label:"الخميس"},{value:"5",label:"الجمعة"}];function A({recordId:t,currAvailabilities:l,setIsOpen:a}){var n;const i=h(),{userId:r}=j(),{data:s,isLoading:m}=f({enabled:!!t,queryKey:["availability",t],queryFn:()=>k(r,t)}),c=(n=s==null?void 0:s.data)==null?void 0:n[0],{mutate:y,isPending:p}=_({mutationFn:t?K:N,onSuccess:()=>{i.invalidateQueries({queryKey:["doctor_availability"]})},onSettled:()=>a(!1)});return m?e.jsx(I,{}):e.jsx(E,{initialValues:{...t?c:$,doctor_id:r},validationSchema:t?U(l,t):T(l),onSubmit:o=>y(o),children:()=>e.jsxs(S,{isSubmitting:p,submitBtnLabel:t?"تعديل":"إضافة",children:[e.jsx(C,{options:z,name:"day",label:"اليوم",placeholder:"اختر اليوم"}),e.jsx(g,{label:"من",name:"start_time",type:"time"}),e.jsx(g,{label:"إلى",name:"end_time",type:"time"})]})})}function G({currAvailabilities:t,recordId:l}){const[a,i]=b.useState(!1);return e.jsx(x,{title:"تعديل موعد",isOpen:a,setIsOpen:i,trigger:e.jsx(L,{className:"stroke-primary"}),children:e.jsx(A,{currAvailabilities:t,recordId:l,isOpen:a,setIsOpen:i})})}const le=F(function(){const{addNewOpen:l,setAddNewOpen:a}=b.useContext(B),{userId:i}=j(),{data:r,isFetching:s,isError:m}=f({queryKey:["doctor_availability","5a6cc0f9-cd61-4929-811f-0364fc66074c"],queryFn:()=>V(i)}),c=(r==null?void 0:r.data)??[],y=(c==null?void 0:c.length)===0,p=[{accessorKey:"day",header:"اليوم",cell:({row:n})=>{const o=n.getValue("day");return w(o)}},{accessorKey:"start_time",header:"من",cell:({row:n})=>{const o=n.getValue("start_time");return v(o)}},{accessorKey:"end_time",header:"إلى",cell:({row:n})=>{const o=n.getValue("end_time");return v(o)}},{header:"تعديل",cell:({row:n})=>{const o=n.original.id;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{recordId:o,currAvailabilities:c}),e.jsx(R,{availabilityId:o})]})}}];return e.jsxs(e.Fragment,{children:[e.jsx(P,{isEmpty:y,isFetching:s,isError:m,children:e.jsx(Q,{data:c??[],columns:p})}),e.jsx(x,{title:"إضافة موعد",isOpen:l,setIsOpen:a,children:e.jsx(A,{setIsOpen:a,currAvailabilities:c})})]})});export{le as default};
