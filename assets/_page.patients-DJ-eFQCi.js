import{p as r,r as p,w as N}from"./chunk-PVWAREVJ-BUjujdbQ.js";import{B as b}from"./Button-CldsT2-O.js";import{f as w,C as y,c as E,d as R,h as j}from"./PatientCard-eSNqWh7A.js";import{Q as F,f as O,R as M,F as C}from"./Delete-QT8d8-P6.js";import{c as I}from"./QueryClientProvider-Cxv-Lvym.js";import{i as x,h as k,a as Q}from"./infiniteQueryBehavior-CZbpnB77.js";import{u as v}from"./usePageContext-_zvzKLEf.js";import"./Input-4BUUtmZ5.js";import"./index.esm-C34H4-xp.js";import"./PageLoader-2oEP0wyP.js";import"./Pencil-erOX2P1g.js";import"./time-CDh3KrcT.js";import"./query-BnZt8Xyc.js";import"./label-BJU9PyNA.js";var A=class extends F{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:x()})}getOptimisticResult(e){return e.behavior=x(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var P,m;const{state:s}=e,o=super.createResult(e,t),{isFetching:n,isRefetching:c,isError:u,isRefetchError:d}=o,h=(m=(P=s.fetchMeta)==null?void 0:P.fetchMore)==null?void 0:m.direction,l=u&&h==="forward",f=n&&h==="forward",a=u&&h==="backward",g=n&&h==="backward";return{...o,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Q(t,s.data),hasPreviousPage:k(t,s.data),isFetchNextPageError:l,isFetchingNextPage:f,isFetchPreviousPageError:a,isFetchingPreviousPage:g,isRefetchError:d&&!l&&!a,isRefetching:c&&!f&&!g}}};function T(e,t){return O(e,A)}function B({className:e}){return r.jsx("div",{className:I("inline-block w-full animate-spin rounded-full border-2 border-primary border-t-transparent",e)})}function _({pageSize:e}){const{search:t}=v(),[s,o]=p.useState(1),n=T({initialPageParam:!!s,queryKey:["patients",t],queryFn:({signal:c})=>w(t,s,e,c),getNextPageParam:({count:c})=>{const u=Math.ceil(c/e);return s<u||void 0},getPreviousPageParam:()=>s===1&&void 0});return p.useEffect(()=>{o(1)},[t]),{...n,page:s,setPage:o}}const Z=N(function(){const{addNewOpen:t,setAddNewOpen:s}=v(),{isPending:o,data:n,refetch:c,isError:u,hasNextPage:d,fetchNextPage:h,setPage:l,isFetchingNextPage:f}=_({pageSize:15}),a=n==null?void 0:n.pages.flatMap(i=>i.data),g=(a==null?void 0:a.length)===0;return r.jsxs(r.Fragment,{children:[r.jsx(M,{isEmpty:g,isFetching:o,isError:u,children:r.jsx("div",{className:"flex h-full flex-col gap-3 overflow-auto",children:r.jsxs(y,{className:"flex-1",children:[a==null?void 0:a.map(i=>r.jsx(E,{variant:R.PATIENT,patient:i},i==null?void 0:i.id)),d&&r.jsx(b,{variant:"secondary",className:"col-span-full mx-auto my-1 flex w-full items-center justify-center rounded-lg p-1.5 text-sm disabled:bg-background disabled:hover:bg-transparent sm:w-1/3",onClick:()=>{l(i=>i+1),h()},disabled:!d||f,children:f?r.jsx(B,{className:"size-6"}):"تحميل المزيد"})]})})}),r.jsx(C,{title:"إضافة مريض",isOpen:t,setIsOpen:s,className:"",children:r.jsx(j,{setIsOpen:s,refetch:c})})]})});export{Z as default};
