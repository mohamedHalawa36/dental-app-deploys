import{r as p,p as e,w as F}from"./chunk-PVWAREVJ-chYXeG9N.js";import{C as D,D as O,u as f,R as S}from"./Delete-CW52lOLR.js";import{e as C,M as P,f as M,g as K,u as N,h as k,i as w,F as g,P as V,j as B}from"./Pencil-bRhwiewe.js";import{j as x,k as d,u as j}from"./QueryClientProvider-b9r43jxz.js";import{u as h,v as I,w as b}from"./utils-k7BbqiBD.js";import{c as _,a as u,F as L,I as v}from"./InputField-Eku4Xlna.js";import{P as Q}from"./useAttachBackBtn-n1K_AgdM.js";import{T as E}from"./Table-DS8CBWOe.js";import{P as T}from"./PageContext-BJHu0vOw.js";import"./query-A0VTYRIv.js";import"./X-CjFVNX7j.js";import"./Input-CykNeVrb.js";import"./button-DopYWWVj.js";import"./index-DpT_dJLM.js";function R({availabilityId:t}){const l=x(),[a,i]=p.useState(!1),{mutate:n,isPending:s}=h({mutationFn:C,onSuccess:()=>{l.invalidateQueries({queryKey:["doctor_availability"]})}});return e.jsx(D,{toggle:()=>i(o=>!o),isOpen:a,isActionsDisabled:s,title:"حذف موعد",trigger:e.jsx(O,{className:"size-6 fill-red-600"}),confirmCallBack:()=>n(t),cancelCallBack:()=>i(!1),children:e.jsx("p",{children:"هل أنت متأكد من حذف هذا الموعد"})})}const $=t=>_({day:u().required(d).test({test:l=>!t.some(a=>a.day===l),message:"يوجد موعد في هذا اليوم بالفعل"}),start_time:u().required(d),end_time:u().required(d),doctor_id:u().required(d)}),z=(t,l)=>_({day:u().test({test:a=>{const i=t.find(s=>s.id===l),n=i==null?void 0:i.day;return!t.filter(s=>s.day!==n).some(s=>s.day===a)},message:"يوجد موعد في هذا اليوم بالفعل"}).required(d),start_time:u().required(d),end_time:u().required(d),doctor_id:u().required(d)}),U={doctor_id:"",start_time:"",end_time:"",day:""},G=[{value:"6",label:"السبت"},{value:"0",label:"الأحد"},{value:"1",label:"الإثنين"},{value:"2",label:"الثلاثاء"},{value:"3",label:"الأربعاء"},{value:"4",label:"الخميس"},{value:"5",label:"الجمعة"}];function q({recordId:t,currAvailabilities:l,setIsOpen:a}){var r;const i=x(),{userId:n}=j(),{data:s,isLoading:o}=f({enabled:!!t,queryKey:["availability",t],queryFn:()=>w(n,t)}),m=(r=s==null?void 0:s.data)==null?void 0:r[0],{mutate:y,isPending:c}=h({mutationFn:t?N:k,onSuccess:()=>{i.invalidateQueries({queryKey:["doctor_availability"]})},onSettled:()=>a(!1)});return o?e.jsx(Q,{}):e.jsx(L,{initialValues:{...t?m:U,doctor_id:n},validationSchema:t?z(l,t):$(l),onSubmit:A=>y(A),children:()=>e.jsxs(P,{submitBtn:e.jsx(K,{label:t?"تعديل":"إضافة",disabled:c}),children:[e.jsx(M,{options:G,name:"day",label:"اليوم",placeholder:"اختر اليوم"}),e.jsx(v,{label:"من",name:"start_time",type:"time"}),e.jsx(v,{label:"إلى",name:"end_time",type:"time"})]})})}function H({currAvailabilities:t,recordId:l}){const[a,i]=p.useState(!1);return e.jsx(g,{title:"تعديل موعد",isOpen:a,setIsOpen:i,trigger:e.jsx(V,{className:"stroke-primary"}),children:e.jsx(q,{currAvailabilities:t,recordId:l,isOpen:a,setIsOpen:i})})}const ce=F(function(){const{addNewOpen:l,setAddNewOpen:a}=p.useContext(T),{userId:i}=j(),{data:n,isFetching:s}=f({queryKey:["doctor_availability","5a6cc0f9-cd61-4929-811f-0364fc66074c"],queryFn:()=>B(i)}),o=(n==null?void 0:n.data)??[],m=(o==null?void 0:o.length)===0,y=[{accessorKey:"day",header:"اليوم",cell:({row:c})=>{const r=c.getValue("day");return I(r)}},{accessorKey:"start_time",header:"من",cell:({row:c})=>{const r=c.getValue("start_time");return b(r)}},{accessorKey:"end_time",header:"إلى",cell:({row:c})=>{const r=c.getValue("end_time");return b(r)}},{header:"تعديل",cell:({row:c})=>{const r=c.original.id;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(H,{recordId:r,currAvailabilities:o}),e.jsx(R,{availabilityId:r})]})}}];return e.jsxs(e.Fragment,{children:[e.jsx(S,{isEmpty:m,isFetching:s,children:e.jsx(E,{data:o??[],columns:y})}),e.jsx(g,{title:"إضافة موعد",isOpen:l,setIsOpen:a,children:e.jsx(q,{setIsOpen:a,currAvailabilities:o})})]})});export{ce as default};
